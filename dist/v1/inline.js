!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((n="undefined"!=typeof globalThis?globalThis:n||self).MimaCheckout={})}(this,function(n){"use strict";function e(n,e){const t=document.createElement(n);return e&&(t.className=e),t}function t(n,...e){return e.forEach(e=>e&&n.appendChild(e)),n}function o(n){return new Promise((t,o)=>{if(function(n,e=document){return Array.from(e.querySelectorAll(n))}(`script[src="${n}"]`).length)return t();const a=e("script");a.src=n,a.async=!0,a.onload=()=>t(),a.onerror=()=>o(new Error(`Failed to load ${n}`)),document.head.appendChild(a)})}function a(n=!0){const e="mima-scroll-lock";n?document.documentElement.classList.add(e):document.documentElement.classList.remove(e)}function r({onClose:n}){const o=e("div","checkoutModal"),r=e("div","backdrop"),i=e("div","modalContent");function s(){var e;a(!1),(e=o)&&e.parentNode&&e.parentNode.removeChild(e),n&&n()}return t(o,r,i),r.addEventListener("click",s),{host:o,backdrop:r,modalContent:i,open:function(){document.body.appendChild(o),a(!0)},close:s}}function i(n,e){n.modalContent.innerHTML="",e&&n.modalContent.appendChild(e)}function s(n=48){const t=e("div","mima-spinner");return t.style.width=`${n}px`,t.style.height=`${n}px`,t}async function c({clientSecret:n,publishableKey:t,container:a,currencyCode:r,amount:i,payButtonEl:s,returnUrl:c,onSuccess:d,onClose:l}){if(await o("https://js.stripe.com/v3"),!window.Stripe)throw new Error("Stripe.js failed to load");const p=window.Stripe(t),m=p.elements({clientSecret:n,appearance:{theme:"stripe"}});m.create("payment").mount(a);const u=s||(()=>{const n=e("button","mima-btn");return n.type="button",n.textContent=`Pay ${function(n,e){try{return new Intl.NumberFormat(void 0,{style:"currency",currency:e}).format(n)}catch{return n}}(i,r)}`,a.parentNode.appendChild(n),n})(),y=e("div","mima-error");u.addEventListener("click",async()=>{u.disabled=!0,y.textContent="";const{error:n}=await p.confirmPayment({elements:m,confirmParams:c?{return_url:c}:{},redirect:"if_required"});if(u.disabled=!1,n)return a.parentNode.appendChild(y),void(y.textContent=n.message||"Payment failed.");d&&d(),l&&l()})}async function d({publicKey:n,email:e,amount:t,metadata:a,onSuccess:r,onClose:i}){if(await o("https://js.paystack.co/v1/inline.js"),!window.PaystackPop)throw new Error("Paystack failed to load");window.PaystackPop.setup({key:n,email:e,amount:Math.round(100*t),metadata:a,callback:function(n){console.log("callback response",n),r&&r(n?.reference)},onClose:function(){i&&i()}}).openIframe()}const l="pk_live_8f9d0f43221de55a2139081d8a530fd65a15e960",p="https://api.trymima.com/v1",m="pk_test_c089002666ab7778df8fe31313c5bba3d6f69914",u="https://dev.trymima.com/v1",y="https://e3bc7d7a5a59a4dca7c1c17bfa0270e4b3.s3.us-east-2.amazonaws.com/e8b61357-334e-4879-90b6-6fbe722cc54c-7e5a1560-43a6-4dea-ac4a-bbbda8598ab3-mima-logo.png";async function f(n){const{payload:t,signature:o,testMode:a=!1,onSuccess:f,onClose:h}=n,g=l,w=m,x="/invoices/new/checkout",v=a?u:p;if(!v)throw new Error("MimaCheckout: `baseUrl` (and optionally `testBaseUrl`) is required.");const C=r({onClose:h});C.open();const k=e("div","mima-center");let S;k.appendChild(s(75)),i(C,k);try{S=await async function({baseUrl:n,path:e,payload:t,signature:o}){const a=`${n}${e}`,r=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json","x-mima-signature":o},body:JSON.stringify(t)}),i=await r.json();if(!r.ok||i?.error)throw new Error(i?.message||"Something went wrong. Please try again.");return i}({baseUrl:v,path:x,payload:t,signature:o})}catch(n){C.open();const t=e("div","mima-error");return t.textContent=n.message,void i(C,t)}if("NGN"===S?.currencyCode){const n=a?w:g;if(!n)return void i(C,b("Paystack key missing."));C.close();try{await d({publicKey:n,email:S?.customer?.email,amount:S?.transactionAmount,metadata:{custom_fields:[{display_name:"business",variable_name:"business",value:S?.business?._id},{display_name:"invoiceNumber",variable_name:"invoiceNumber",value:`INV-${S?.number}`},{display_name:"customerName",variable_name:"customerName",value:S?.customer?.fullname},{display_name:"invoice",variable_name:"invoice",value:S?._id},{display_name:"type",variable_name:"type",value:"INVOICE"}]},onSuccess:()=>{f&&f(),C.close()},onClose:()=>{h&&h(),C.close()}})}catch(n){C.open(),i(C,b(n.message))}return}C.open();const P=a?"pk_test_51MZRkkCxdM6WOQdWKpad49vDaWdY0xINxv5Rkipm2RZJ0jkYDtD17mpPlWTDdceDJXKDpEeqXeS8Y7GMxu38Lub300QAKMidAd":"pk_live_51MZRkkCxdM6WOQdWPUtgMWcdORUTEPS4o4EL1CydZ8pcWBw1PTjkcenRZmcMFCaZaknuuAKq0488T8s9ywaOKZwS00euXJ5lap";if(!P)return void i(C,b("Stripe key missing."));if(!S?.stripeSessionId)return void i(C,b("Stripe client secret missing."));const E=e("div","mima-stripe-wrap"),M=e("div","mima-top"),_=e("p");_.style.color="#464646";const N=e("span","mima-top-span");N.textContent=`${S.currencyCode} ${S.transactionAmount}`,_.textContent="Pay ",_.appendChild(N);const j=e("p","mima-top-first");j.textContent="All transactions are secure and encrypted.",M.appendChild(_),M.appendChild(j),E.appendChild(M);const T=e("div","mima-stripe-mount");E.appendChild(T);const U=e("div","mima-stripe-actions"),O=e("button","mima-btn outlined full");O.type="button",O.textContent="Go Back",O.addEventListener("click",()=>{C.close(),h&&h()});const L=e("button","mima-btn full");L.type="button",L.textContent="Pay now",U.appendChild(O),U.appendChild(L),E.appendChild(U);const B=e("a","mima-powered");B.href="https://mimapay.africa/",B.target="_blank",B.rel="noopener noreferrer";const $=e("span");$.textContent="Powered by",B.appendChild($);{const n=document.createElement("img");n.src=y,n.alt="Mima Logo",n.className="mima-powered-logo",B.appendChild(n)}E.appendChild(B),i(C,E);try{await c({clientSecret:S.stripeSessionId,publishableKey:P,container:T,currencyCode:S.currencyCode,amount:S.transactionAmount,payButtonEl:L,returnUrl:t?.callBackUrl&&t.callBackUrl.startsWith("http")?t.callBackUrl:window.location.href,onSuccess:()=>{f&&f(),C.close()},onClose:()=>C.close()})}catch(n){i(C,b(n.message))}}function b(n){const t=e("div","mima-error");return t.textContent=n||"An error occurred.",t}async function h({baseUrl:n,path:t,payload:o,onClose:a,onSuccess:c}){let d;const l=r({onClose:a});l.open();const p=e("div","mima-center");p.appendChild(s(75)),i(l,p),l.close();try{d=await async function({baseUrl:n,path:e,payload:t}){const o=`${n}${e}`,a=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await a.json();if(!a.ok||r?.error)throw new Error(r?.message||"Something went wrong. Please try again.");return r}({baseUrl:n,path:t,payload:o}),c(),console.log("subscription",d)}catch(n){l.open();const t=e("div","mima-error");return t.textContent=n.message,void i(l,t)}}async function g(n){const{payload:t,signature:o,testMode:a=!1,onSuccess:c,onClose:y}=n;if(!t.currencyCode||!t.amount)throw new Error("MimaSubscribe: `currencyCode` and `amount` are required in payload.");const f=t?.currencyCode;console.log("payload",t);const b=l,g=m,w="/business-subscription/subscribe",x="/customers/external-customer",v="/customers/add-customer-card",C=a?u:p;if(!C)throw new Error("MimaSubscribe: `baseUrl` (and optionally `testBaseUrl`) is required.");const k=r({onClose:y});k.open();const S=e("div","mima-center");let P;S.appendChild(s(75)),i(k,S);const E={publicKey:t?.publicKey,...t?.customer};try{P=await async function({baseUrl:n,path:e,payload:t}){const o=`${n}${e}`,a=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await a.json();if(!a.ok||r?.error)throw new Error(r?.message||"Something went wrong. Please try again.");return r}({baseUrl:C,path:x,payload:E})}catch(n){k.open();const t=e("div","mima-error");return t.textContent=n.message,void i(k,t)}if(console.log("customer",P),P?.customer?.fullname&&"NGN"===f){const n=a?g:b;if(!n)return void i(k,errorNode("Paystack key missing."));k.close(),console.log("customerPayload",E);try{await d({publicKey:n,email:t?.customer?.email,amount:t?.amount,metadata:{custom_fields:[{display_name:"type",variable_name:"type",value:"SUBSCRIPTION"}]},onSuccess:async n=>{console.log("reference",n);try{const e=await async function({baseUrl:n,path:e,payload:t}){const o=`${n}${e}`,a=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await a.json();if(!a.ok||r?.error)throw new Error(r?.message||"Something went wrong. Please try again.");return r}({baseUrl:C,path:v,payload:{email:t?.customer?.email,reference:n}});console.log("saveCard",e),e?.card&&(console.log("started subbing"),await h({baseUrl:C,path:w,payload:{plan:t?.plan,customer:t?.customer,publicKey:t?.publicKey},onClose:y&&y(),onSuccess:c&&c()}))}catch(n){k.open();const t=e("div","mima-error");return t.textContent=n.message,void i(k,t)}k.close()},onClose:()=>{y&&y(),k.close()}})}catch(n){k.open(),i(k,errorNode(n.message))}return}}function w(){if(document.getElementById("mima-styles"))return;const n=document.createElement("style");n.id="mima-styles",n.textContent="\n* {\n  line-height: 1.2;\n}\nh1,h2,h3,h4,h5,h6,p {\n  all: unset;\n  line-height: 1.4;\n  display: block;\n}\nh1,h2,h3,h4,h5,h6 { font-weight: 600; }\n\n:root {\n  --primary-normal: #1f68d6;\n  --primary-hover: #003c97;\n  --grey-200: #e5e7eb;\n  --dark-700: #414651;\n  --dark-900: #1f2937;\n}\n\n/* Overlay & Modal */\n.mima-scroll-lock { overflow: hidden; }\n\n.checkoutModal {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100vw;\n  height: 100vh;\n  z-index: 9999;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-family: inherit;\n}\n\n.backdrop {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.4);\n  top: 0;\n  left: 0;\n  z-index: -1;\n}\n\n.modalContent {\n    background-color: #fff;\n  padding: 30px 20px;\n  border-radius: 12px;\n  position: relative;\n  z-index: 10000;\n  animation: modalFadeIn 0.25s ease-out;\n}\n\n@keyframes modalFadeIn {\n  0% { opacity:0; transform:scale(.96); }\n  100% { opacity:1; transform:scale(1); }\n}\n\n/* Header */\n.mima-head { display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid #eee; }\n.mima-title { font-weight:600; font-size:16px; }\n.mima-close { background:transparent; border:none; font-size:24px; cursor:pointer; }\n\n/* Body + Footer */\n.mima-body { padding:16px; }\n.mima-foot { padding:12px 16px 16px; }\n\n/* Buttons */\n.buttonBase,\n.mima-btn {\n  height:40px;\n  padding:8px 12px;\n  border-radius:6px;\n  cursor:pointer;\n  width:fit-content;\n  display:flex;\n  justify-content:center;\n  align-items:center;\n  gap:8px;\n  white-space:nowrap;\n  outline:none;\n  border:none;\n  font-weight:600;\n  transition: background-color .2s ease;\n  box-sizing: border-box;\n}\n.buttonBase:disabled,\n.mima-btn:disabled,\n.mima-btn.disabled {\n  background-color:#ccc;\n  cursor:not-allowed;\n}\n.buttonDefault,\n.mima-btn {\n  background-color:var(--primary-normal);\n  color:#fff;\n}\n.buttonDefault:hover,\n.mima-btn:hover { background-color:var(--primary-hover); }\n.buttonOutlined,\n.mima-btn.outlined {\n  background:transparent;\n  border:1px solid var(--grey-200);\n  color:var(--dark-700);\n}\n.buttonOutlined:hover,\n.mima-btn.outlined:hover {\n  border-color:var(--dark-700);\n  color:var(--dark-900);\n  background-color:var(--grey-200);\n}\n.buttonText,\n.mima-btn.text {\n  background:transparent;\n  color:var(--primary-normal);\n}\n.buttonText:hover,\n.mima-btn.text:hover { color:var(--primary-hover); }\n.buttonFull,\n.mima-btn.full { width:100%; }\n.buttonDisabled { opacity:.6; pointer-events:none; }\n\n/* Error + Loading */\n\n.mima-error {\n  background:#fff;\n  color:#d32f2f;\n  font-weight:500;\n  padding:20px;\n  border-radius:10px;\n  border:1px solid #d32f2f;\n  text-align:center;\n}\n\n.mima-center {\n  display:flex;\n  align-items:center;\n  justify-content:center;\n  background:#fff;\n  padding:20px;\n  border-radius:10px;\n}\n\n/* Spinner */\n.spinner,\n.mima-spinner {\n  border:2px solid rgba(0,0,0,.1);\n  border-top:2px solid var(--primary-normal);\n  border-radius:50%;\n  width:20px;\n  height:20px;\n  animation: spin .6s linear infinite;\n}\n@keyframes spin { to { transform:rotate(360deg); } }\n\n/* Options & Stripe */\n.mima-option { display:flex; flex-direction: column; align-items: flex-start; gap:12px; border:1px solid #eee; padding:12px; border-radius:12px;}\n.mima-option-logo,\n.logo { height:24px; object-fit:contain; display:block; }\n.mima-option-label,\n.label { display:flex; align-items:center; gap:8px; cursor:pointer; }\n.labelText { font-weight:500; }\n\n.mima-stripe-wrap { display:flex; flex-direction:column; gap:12px; width: 500px; max-width: 100%; }\n.mima-stripe-mount { padding:8px; border:1px solid #eee; border-radius:12px; }\n.mima-stripe-actions { display:grid; grid-template-columns:150px 1fr; gap:1rem; width:100%; margin-top:12px; }\n\n/* Top Section */\n.mima-top,\n.checkoutTop { margin-bottom:8px; display:flex; flex-direction:column; font-size:20px; }\n.mima-top-span,\n.checkoutTopSpan { font-weight:600; color:#136e13; }\n.mima-top-first,\n.checkoutTopFirst { color:#6b7280; font-size:14px; margin-top:4px; }\n\n/* Powered by */\n.mima-powered,\n.mima {display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-top: 10px;\n  gap: 10px;\n  text-decoration: none;\n  color: var(--dark-900); }\n.mima-powered-logo,\n.logo { height: 25px;\n  width: auto;\n  object-fit: contain;\n  display: block; }\n",document.head.appendChild(n)}function x(n){if(!n||!n.payload||!n.signature)throw new Error("MimaCheckout: `payload` and `signature` are required.");return n}const v={open:n=>(w(),f(x(n))),renderButton:n=>(w(),function({selector:n,title:e="Pay with Mima",className:t="",...o}){const a="string"==typeof n?document.querySelector(n):n;if(!a)throw new Error("MimaButton: host element not found");a.classList.add("mima-btn"),t&&a.classList.add(...t.split(" ")),a.textContent=e,a.addEventListener("click",()=>f(o))}(x(n))),renderOption:n=>(w(),function({selector:n,title:o="Pay with Mima",className:a="",...r}){const i="string"==typeof n?document.querySelector(n):n;if(!i)throw new Error("PayWithMima: host element not found");i.classList.add("mima-option"),a&&i.classList.add(...a.split(" "));const s=e("label","mima-option-label"),c=e("input");c.type="radio",c.name=r?.groupName||"mima-pay-option";const d=e("span","mima-option-text");d.textContent=o;const l=e("img","mima-option-logo");l.src=y,l.alt="Mima Logo";const p=e("button","mima-btn full");p.type="button",p.textContent="Pay now",p.style.display="none",c.addEventListener("change",()=>{p.style.display=c.checked?"block":"none"}),p.addEventListener("click",()=>f(r)),t(s,c,d),t(i,s,l,p)}(x(n)))},C={open:n=>(w(),g(function(n){if(!n||!n.payload)throw new Error("MimaSubscribe: `payload` is required.");return n}(n)))};"undefined"!=typeof window&&(window.MimaCheckout=v,window.MimaSubscribe=C),n.MimaCheckout=v,n.MimaSubscribe=C,n.default=v,Object.defineProperty(n,"__esModule",{value:!0})});
//# sourceMappingURL=inline.js.map
