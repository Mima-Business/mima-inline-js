function n(n,e){const t=document.createElement(n);return e&&(t.className=e),t}function e(n,...e){return e.forEach(e=>e&&n.appendChild(e)),n}function t(e){return new Promise((t,o)=>{if(function(n,e=document){return Array.from(e.querySelectorAll(n))}(`script[src="${e}"]`).length)return t();const a=n("script");a.src=e,a.async=!0,a.onload=()=>t(),a.onerror=()=>o(new Error(`Failed to load ${e}`)),document.head.appendChild(a)})}function o(n=!0){const e="mima-scroll-lock";n?document.documentElement.classList.add(e):document.documentElement.classList.remove(e)}function a({onClose:t}){const a=n("div","checkoutModal"),r=n("div","backdrop"),i=n("div","modalContent");function s(){var n;o(!1),(n=a)&&n.parentNode&&n.parentNode.removeChild(n),t&&t()}return e(a,r,i),r.addEventListener("click",s),{host:a,backdrop:r,modalContent:i,open:function(){document.body.appendChild(a),o(!0)},close:s}}function r(n,e){n.modalContent.innerHTML="",e&&n.modalContent.appendChild(e)}function i(e=48){const t=n("div","mima-spinner");return t.style.width=`${e}px`,t.style.height=`${e}px`,t}async function s({clientSecret:e,publishableKey:o,container:a,currencyCode:r,amount:i,payButtonEl:s,returnUrl:c,onSuccess:d,onClose:l}){if(await t("https://js.stripe.com/v3"),!window.Stripe)throw new Error("Stripe.js failed to load");const p=window.Stripe(o),m=p.elements({clientSecret:e,appearance:{theme:"stripe"}});m.create("payment").mount(a);const u=s||(()=>{const e=n("button","mima-btn");return e.type="button",e.textContent=`Pay ${function(n,e){try{return new Intl.NumberFormat(void 0,{style:"currency",currency:e}).format(n)}catch{return n}}(i,r)}`,a.parentNode.appendChild(e),e})(),y=n("div","mima-error");u.addEventListener("click",async()=>{u.disabled=!0,y.textContent="";const{error:n}=await p.confirmPayment({elements:m,confirmParams:c?{return_url:c}:{},redirect:"if_required"});if(u.disabled=!1,n)return a.parentNode.appendChild(y),void(y.textContent=n.message||"Payment failed.");d&&d(),l&&l()})}async function c({publicKey:n,email:e,amount:o,metadata:a,onSuccess:r,onClose:i}){if(await t("https://js.paystack.co/v1/inline.js"),!window.PaystackPop)throw new Error("Paystack failed to load");window.PaystackPop.setup({key:n,email:e,amount:Math.round(100*o),metadata:a,callback:function(n){r&&r(n?.reference)},onClose:function(){i&&i()}}).openIframe()}const d="pk_live_8f9d0f43221de55a2139081d8a530fd65a15e960",l="https://api.trymima.com/v1",p="pk_test_c089002666ab7778df8fe31313c5bba3d6f69914",m="https://dev.trymima.com/v1",u="https://e3bc7d7a5a59a4dca7c1c17bfa0270e4b3.s3.us-east-2.amazonaws.com/e8b61357-334e-4879-90b6-6fbe722cc54c-7e5a1560-43a6-4dea-ac4a-bbbda8598ab3-mima-logo.png";async function y(e){const{payload:t,signature:o,testMode:y=!1,onSuccess:b,onClose:f}=e,g=d,w=p,x="/invoices/new/checkout",v=y?m:l;if(!v)throw new Error("MimaCheckout: `baseUrl` (and optionally `testBaseUrl`) is required.");const C=a({onClose:f});C.open();const k=n("div","mima-center");let S;k.appendChild(i(75)),r(C,k);try{S=await async function({baseUrl:n,path:e,payload:t,signature:o}){const a=`${n}${e}`,r=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json","x-mima-signature":o},body:JSON.stringify(t)}),i=await r.json();if(!r.ok||i?.error)throw new Error(i?.message||"Something went wrong. Please try again.");return i}({baseUrl:v,path:x,payload:t,signature:o})}catch(e){C.open();const t=n("div","mima-error");return t.textContent=e.message,void r(C,t)}if("NGN"===S?.currencyCode){const n=y?w:g;if(!n)return void r(C,h("Paystack key missing."));C.close();try{await c({publicKey:n,email:S?.customer?.email,amount:S?.transactionAmount,metadata:{custom_fields:[{display_name:"business",variable_name:"business",value:S?.business?._id},{display_name:"invoiceNumber",variable_name:"invoiceNumber",value:`INV-${S?.number}`},{display_name:"customerName",variable_name:"customerName",value:S?.customer?.fullname},{display_name:"invoice",variable_name:"invoice",value:S?._id},{display_name:"type",variable_name:"type",value:"INVOICE"}]},onSuccess:()=>{b&&b(),C.close()},onClose:()=>{f&&f(),C.close()}})}catch(n){C.open(),r(C,h(n.message))}return}C.open();const E=y?"pk_test_51MZRkkCxdM6WOQdWKpad49vDaWdY0xINxv5Rkipm2RZJ0jkYDtD17mpPlWTDdceDJXKDpEeqXeS8Y7GMxu38Lub300QAKMidAd":"pk_live_51MZRkkCxdM6WOQdWPUtgMWcdORUTEPS4o4EL1CydZ8pcWBw1PTjkcenRZmcMFCaZaknuuAKq0488T8s9ywaOKZwS00euXJ5lap";if(!E)return void r(C,h("Stripe key missing."));if(!S?.stripeSessionId)return void r(C,h("Stripe client secret missing."));const P=n("div","mima-stripe-wrap"),N=n("div","mima-top"),M=n("p");M.style.color="#464646";const _=n("span","mima-top-span");_.textContent=`${S.currencyCode} ${S.transactionAmount}`,M.textContent="Pay ",M.appendChild(_);const U=n("p","mima-top-first");U.textContent="All transactions are secure and encrypted.",N.appendChild(M),N.appendChild(U),P.appendChild(N);const j=n("div","mima-stripe-mount");P.appendChild(j);const T=n("div","mima-stripe-actions"),L=n("button","mima-btn outlined full");L.type="button",L.textContent="Go Back",L.addEventListener("click",()=>{C.close(),f&&f()});const $=n("button","mima-btn full");$.type="button",$.textContent="Pay now",T.appendChild(L),T.appendChild($),P.appendChild(T);const B=n("a","mima-powered");B.href="https://mimapay.africa/",B.target="_blank",B.rel="noopener noreferrer";const O=n("span");O.textContent="Powered by",B.appendChild(O);{const n=document.createElement("img");n.src=u,n.alt="Mima Logo",n.className="mima-powered-logo",B.appendChild(n)}P.appendChild(B),r(C,P);try{await s({clientSecret:S.stripeSessionId,publishableKey:E,container:j,currencyCode:S.currencyCode,amount:S.transactionAmount,payButtonEl:$,returnUrl:t?.callBackUrl&&t.callBackUrl.startsWith("http")?t.callBackUrl:window.location.href,onSuccess:()=>{b&&b(),C.close()},onClose:()=>C.close()})}catch(n){r(C,h(n.message))}}function h(e){const t=n("div","mima-error");return t.textContent=e||"An error occurred.",t}async function b({baseUrl:e,path:t,payload:o,onClose:s,onSuccess:c}){let d;const l=a({onClose:s});l.open();const p=n("div","mima-center");p.appendChild(i(75)),r(l,p);try{d=await async function({baseUrl:n,path:e,payload:t}){const o=`${n}${e}`,a=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await a.json();if(!a.ok||r?.error)throw new Error(r?.message||"Something went wrong. Please try again.");return r}({baseUrl:e,path:t,payload:o}),l.close(),c()}catch(e){l.open();const t=n("div","mima-error");return t.textContent=e.message,void r(l,t)}}async function f(e){const{payload:t,signature:o,testMode:s=!1,onSuccess:u,onClose:y}=e,h=d,f=p,g="/business-subscription/subscribe",w="/customers/external-customer",x="/customers/add-customer-card",v="/business-subscription/external/plan",C=s?m:l;if(!C)throw new Error("MimaSubscribe: `baseUrl` (and optionally `testBaseUrl`) is required.");const k=a({onClose:y});k.open();const S=n("div","mima-center");let E;S.appendChild(i(75)),r(k,S);const P={publicKey:t?.publicKey,...t?.customer};try{E=await async function({baseUrl:n,path:e,payload:t}){const o=`${n}${e}`,a=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await a.json();if(!a.ok||r?.error)throw new Error(r?.message||"Something went wrong. Please try again.");return r}({baseUrl:C,path:w,payload:P})}catch(e){k.open();const t=n("div","mima-error");return t.textContent=e.message,void r(k,t)}let N;try{N=await async function({baseUrl:n,path:e,plan:t,publicKey:o}){const a=`${n}${e}?publicKey=${o}&id=${t}`,r=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json"}}),i=await r.json();if(!r.ok||i?.error)throw new Error(i?.message||"Something went wrong. Please try again.");return i}({baseUrl:C,path:v,plan:t?.plan,publicKey:t?.publicKey})}catch(e){k.open();const t=n("div","mima-error");return t.textContent=e.message,void r(k,t)}if(E?.customer?.fullname&&"NGN"===N?.currencyCode){const e=s?f:h;if(!e)return void r(k,errorNode("Paystack key missing."));let o;k.close();try{await c({publicKey:e,channels:["card"],email:t?.customer?.email,amount:N?.amount,metadata:{custom_fields:[{display_name:"type",variable_name:"type",value:"SUBSCRIPTION"}]},onSuccess:async e=>{try{o=await async function({baseUrl:n,path:e,payload:t}){const o=`${n}${e}`,a=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await a.json();if(!a.ok||r?.error)throw new Error(r?.message||"Something went wrong. Please try again.");return r}({baseUrl:C,path:x,payload:{email:t?.customer?.email,reference:e}}),o?.card&&await b({baseUrl:C,path:g,payload:{plan:t?.plan,customer:t?.customer,publicKey:t?.publicKey},onClose:y,onSuccess:u})}catch(e){k.open();const t=n("div","mima-error");return t.textContent=e.message,void r(k,t)}k.close()},onClose:()=>{o?.card||y&&y(),k.close()}})}catch(n){k.open(),r(k,errorNode(n.message))}return}}function g(){if(document.getElementById("mima-styles"))return;const n=document.createElement("style");n.id="mima-styles",n.textContent="\n* {\n  line-height: 1.2;\n}\nh1,h2,h3,h4,h5,h6,p {\n  all: unset;\n  line-height: 1.4;\n  display: block;\n}\nh1,h2,h3,h4,h5,h6 { font-weight: 600; }\n\n:root {\n  --primary-normal: #1f68d6;\n  --primary-hover: #003c97;\n  --grey-200: #e5e7eb;\n  --dark-700: #414651;\n  --dark-900: #1f2937;\n}\n\n/* Overlay & Modal */\n.mima-scroll-lock { overflow: hidden; }\n\n.checkoutModal {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100vw;\n  height: 100vh;\n  z-index: 9999;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-family: inherit;\n}\n\n.backdrop {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.4);\n  top: 0;\n  left: 0;\n  z-index: -1;\n}\n\n.modalContent {\n    background-color: #fff;\n  padding: 30px 20px;\n  border-radius: 12px;\n  position: relative;\n  z-index: 10000;\n  animation: modalFadeIn 0.25s ease-out;\n}\n\n@keyframes modalFadeIn {\n  0% { opacity:0; transform:scale(.96); }\n  100% { opacity:1; transform:scale(1); }\n}\n\n/* Header */\n.mima-head { display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid #eee; }\n.mima-title { font-weight:600; font-size:16px; }\n.mima-close { background:transparent; border:none; font-size:24px; cursor:pointer; }\n\n/* Body + Footer */\n.mima-body { padding:16px; }\n.mima-foot { padding:12px 16px 16px; }\n\n/* Buttons */\n.buttonBase,\n.mima-btn {\n  height:40px;\n  padding:8px 12px;\n  border-radius:6px;\n  cursor:pointer;\n  width:fit-content;\n  display:flex;\n  justify-content:center;\n  align-items:center;\n  gap:8px;\n  white-space:nowrap;\n  outline:none;\n  border:none;\n  font-weight:600;\n  transition: background-color .2s ease;\n  box-sizing: border-box;\n}\n.buttonBase:disabled,\n.mima-btn:disabled,\n.mima-btn.disabled {\n  background-color:#ccc;\n  cursor:not-allowed;\n}\n.buttonDefault,\n.mima-btn {\n  background-color:var(--primary-normal);\n  color:#fff;\n}\n.buttonDefault:hover,\n.mima-btn:hover { background-color:var(--primary-hover); }\n.buttonOutlined,\n.mima-btn.outlined {\n  background:transparent;\n  border:1px solid var(--grey-200);\n  color:var(--dark-700);\n}\n.buttonOutlined:hover,\n.mima-btn.outlined:hover {\n  border-color:var(--dark-700);\n  color:var(--dark-900);\n  background-color:var(--grey-200);\n}\n.buttonText,\n.mima-btn.text {\n  background:transparent;\n  color:var(--primary-normal);\n}\n.buttonText:hover,\n.mima-btn.text:hover { color:var(--primary-hover); }\n.buttonFull,\n.mima-btn.full { width:100%; }\n.buttonDisabled { opacity:.6; pointer-events:none; }\n\n/* Error + Loading */\n\n.mima-error {\n  background:#fff;\n  color:#d32f2f;\n  font-weight:500;\n  padding:20px;\n  border-radius:10px;\n  border:1px solid #d32f2f;\n  text-align:center;\n}\n\n.mima-center {\n  display:flex;\n  align-items:center;\n  justify-content:center;\n  background:#fff;\n  padding:20px;\n  border-radius:10px;\n}\n\n/* Spinner */\n.spinner,\n.mima-spinner {\n  border:2px solid rgba(0,0,0,.1);\n  border-top:2px solid var(--primary-normal);\n  border-radius:50%;\n  width:20px;\n  height:20px;\n  animation: spin .6s linear infinite;\n}\n@keyframes spin { to { transform:rotate(360deg); } }\n\n/* Options & Stripe */\n.mima-option { display:flex; flex-direction: column; align-items: flex-start; gap:12px; border:1px solid #eee; padding:12px; border-radius:12px;}\n.mima-option-logo,\n.logo { height:24px; object-fit:contain; display:block; }\n.mima-option-label,\n.label { display:flex; align-items:center; gap:8px; cursor:pointer; }\n.labelText { font-weight:500; }\n\n.mima-stripe-wrap { display:flex; flex-direction:column; gap:12px; width: 500px; max-width: 100%; }\n.mima-stripe-mount { padding:8px; border:1px solid #eee; border-radius:12px; }\n.mima-stripe-actions { display:grid; grid-template-columns:150px 1fr; gap:1rem; width:100%; margin-top:12px; }\n\n/* Top Section */\n.mima-top,\n.checkoutTop { margin-bottom:8px; display:flex; flex-direction:column; font-size:20px; }\n.mima-top-span,\n.checkoutTopSpan { font-weight:600; color:#136e13; }\n.mima-top-first,\n.checkoutTopFirst { color:#6b7280; font-size:14px; margin-top:4px; }\n\n/* Powered by */\n.mima-powered,\n.mima {display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-top: 10px;\n  gap: 10px;\n  text-decoration: none;\n  color: var(--dark-900); }\n.mima-powered-logo,\n.logo { height: 25px;\n  width: auto;\n  object-fit: contain;\n  display: block; }\n",document.head.appendChild(n)}function w(n){if(!n||!n.payload||!n.signature)throw new Error("MimaCheckout: `payload` and `signature` are required.");return n}function x(n){if(!n||!n.payload)throw new Error("MimaSubscribe: `payload` is required.");return n}const v={open:n=>(g(),y(w(n))),renderButton:n=>(g(),function({selector:n,title:e="Pay with Mima",className:t="",...o}){const a="string"==typeof n?document.querySelector(n):n;if(!a)throw new Error("MimaButton: host element not found");a.classList.add("mima-btn"),t&&a.classList.add(...t.split(" ")),a.textContent=e,a.addEventListener("click",()=>y(o))}(w(n))),renderOption:t=>(g(),function({selector:t,title:o="Pay with Mima",className:a="",...r}){const i="string"==typeof t?document.querySelector(t):t;if(!i)throw new Error("PayWithMima: host element not found");i.classList.add("mima-option"),a&&i.classList.add(...a.split(" "));const s=n("label","mima-option-label"),c=n("input");c.type="radio",c.name=r?.groupName||"mima-pay-option";const d=n("span","mima-option-text");d.textContent=o;const l=n("img","mima-option-logo");l.src=u,l.alt="Mima Logo";const p=n("button","mima-btn full");p.type="button",p.textContent="Pay now",p.style.display="none",c.addEventListener("change",()=>{p.style.display=c.checked?"block":"none"}),p.addEventListener("click",()=>y(r)),e(s,c,d),e(i,s,l,p)}(w(t)))},C={open:n=>(g(),f(x(n))),renderButton:n=>(g(),function({selector:n,title:e="Pay now",className:t="",...o}){const a="string"==typeof n?document.querySelector(n):n;if(!a)throw new Error("MimaButton: host element not found");a.classList.add("mima-btn"),t&&a.classList.add(...t.split(" ")),a.textContent=e,a.addEventListener("click",()=>f(o))}(x(n)))};"undefined"!=typeof window&&(window.MimaCheckout=v,window.MimaSubscribe=C);export{v as MimaCheckout,C as MimaSubscribe,v as default};
//# sourceMappingURL=index.esm.js.map
