function n(n,e){const t=document.createElement(n);return e&&(t.className=e),t}function e(n,...e){return e.forEach(e=>e&&n.appendChild(e)),n}function t(e){return new Promise((t,o)=>{if(function(n,e=document){return Array.from(e.querySelectorAll(n))}(`script[src="${e}"]`).length)return t();const a=n("script");a.src=e,a.async=!0,a.onload=()=>t(),a.onerror=()=>o(new Error(`Failed to load ${e}`)),document.head.appendChild(a)})}function o(n=!0){const e="mima-scroll-lock";n?document.documentElement.classList.add(e):document.documentElement.classList.remove(e)}function a(n,e){n.modalContent.innerHTML="",e&&n.modalContent.appendChild(e)}async function i({clientSecret:e,publishableKey:o,container:a,currencyCode:i,amount:r,payButtonEl:s,returnUrl:d,onSuccess:c,onClose:l}){if(await t("https://js.stripe.com/v3"),!window.Stripe)throw new Error("Stripe.js failed to load");const p=window.Stripe(o),m=p.elements({clientSecret:e,appearance:{theme:"stripe"}});m.create("payment").mount(a);const u=s||(()=>{const e=n("button","mima-btn");return e.type="button",e.textContent=`Pay ${function(n,e){try{return new Intl.NumberFormat(void 0,{style:"currency",currency:e}).format(n)}catch{return n}}(r,i)}`,a.parentNode.appendChild(e),e})(),f=n("div","mima-error");u.addEventListener("click",async()=>{u.disabled=!0,f.textContent="";const{error:n}=await p.confirmPayment({elements:m,confirmParams:d?{return_url:d}:{},redirect:"if_required"});if(u.disabled=!1,n)return a.parentNode.appendChild(f),void(f.textContent=n.message||"Payment failed.");c&&c(),l&&l()})}const r="https://e3bc7d7a5a59a4dca7c1c17bfa0270e4b3.s3.us-east-2.amazonaws.com/e8b61357-334e-4879-90b6-6fbe722cc54c-7e5a1560-43a6-4dea-ac4a-bbbda8598ab3-mima-logo.png";async function s(s){const{payload:c,signature:l,testMode:p=!1,onSuccess:m,onClose:u}=s,f="/invoices/new/checkout",b=p?"https://dev.trymima.com/v1":"https://api.trymima.com/v1";if(console.log("chosenBase",b),!b)throw new Error("MimaCheckout: `baseUrl` (and optionally `testBaseUrl`) is required.");const h=function({onClose:t}){const a=n("div","checkoutModal"),i=n("div","backdrop"),r=n("div","modalContent");function s(){var n;o(!1),(n=a)&&n.parentNode&&n.parentNode.removeChild(n),t&&t()}return e(a,i,r),i.addEventListener("click",s),{host:a,backdrop:i,modalContent:r,open:function(){document.body.appendChild(a),o(!0)},close:s}}({onClose:u});h.open();const y=n("div","mima-center");let g;y.appendChild(function(e=48){const t=n("div","mima-spinner");return t.style.width=`${e}px`,t.style.height=`${e}px`,t}(75)),a(h,y);try{g=await async function({baseUrl:n,path:e,payload:t,signature:o}){const a=`${n}${e}`,i=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json","x-mima-signature":o},body:JSON.stringify(t)}),r=await i.json();if(!i.ok||r?.error)throw new Error(r?.message||"Something went wrong. Please try again.");return r}({baseUrl:b,path:f,payload:c,signature:l})}catch(e){h.open();const t=n("div","mima-error");return t.textContent=e.message,void a(h,t)}if("NGN"===g?.currencyCode){const n=p?"pk_test_c089002666ab7778df8fe31313c5bba3d6f69914":"pk_live_8f9d0f43221de55a2139081d8a530fd65a15e960";if(!n)return void a(h,d("Paystack key missing."));h.close();try{await async function({publicKey:n,email:e,amount:o,metadata:a,onSuccess:i,onClose:r}){if(await t("https://js.paystack.co/v1/inline.js"),!window.PaystackPop)throw new Error("Paystack failed to load");window.PaystackPop.setup({key:n,email:e,amount:Math.round(100*o),metadata:a,callback:function(){i&&i()},onClose:function(){r&&r()}}).openIframe()}({publicKey:n,email:g?.customer?.email,amount:g?.transactionAmount,metadata:{custom_fields:[{display_name:"business",variable_name:"business",value:g?.business?._id},{display_name:"invoiceNumber",variable_name:"invoiceNumber",value:`INV-${g?.number}`},{display_name:"customerName",variable_name:"customerName",value:g?.customer?.fullname},{display_name:"invoice",variable_name:"invoice",value:g?._id},{display_name:"type",variable_name:"type",value:"INVOICE"}]},onSuccess:()=>{m&&m(),h.close()},onClose:()=>{u&&u(),h.close()}})}catch(n){a(h,d(n.message))}return}h.open();const x=p?"pk_test_51MZRkkCxdM6WOQdWKpad49vDaWdY0xINxv5Rkipm2RZJ0jkYDtD17mpPlWTDdceDJXKDpEeqXeS8Y7GMxu38Lub300QAKMidAd":"pk_live_51MZRkkCxdM6WOQdWPUtgMWcdORUTEPS4o4EL1CydZ8pcWBw1PTjkcenRZmcMFCaZaknuuAKq0488T8s9ywaOKZwS00euXJ5lap";if(!x)return void a(h,d("Stripe key missing."));if(!g?.stripeSessionId)return void a(h,d("Stripe client secret missing."));const w=n("div","mima-stripe-wrap"),v=n("div","mima-top"),k=n("p");k.style.color="#464646";const C=n("span","mima-top-span");C.textContent=`${g.currencyCode} ${g.transactionAmount}`,k.textContent="Pay ",k.appendChild(C);const E=n("p","mima-top-first");E.textContent="All transactions are secure and encrypted.",v.appendChild(k),v.appendChild(E),w.appendChild(v);const S=n("div","mima-stripe-mount");w.appendChild(S);const P=n("div","mima-stripe-actions"),_=n("button","mima-btn outlined full");_.type="button",_.textContent="Go Back",_.addEventListener("click",()=>{h.close(),u&&u()});const M=n("button","mima-btn full");M.type="button",M.textContent="Pay now",P.appendChild(_),P.appendChild(M),w.appendChild(P);const N=n("a","mima-powered");N.href="https://mimapay.africa/",N.target="_blank",N.rel="noopener noreferrer";const L=n("span");L.textContent="Powered by",N.appendChild(L);{const n=document.createElement("img");n.src=r,n.alt="Mima Logo",n.className="mima-powered-logo",N.appendChild(n)}w.appendChild(N),a(h,w);try{await i({clientSecret:g.stripeSessionId,publishableKey:x,container:S,currencyCode:g.currencyCode,amount:g.transactionAmount,payButtonEl:M,returnUrl:c?.callBackUrl&&c.callBackUrl.startsWith("http")?c.callBackUrl:window.location.href,onSuccess:()=>{m&&m(),h.close()},onClose:()=>h.close()})}catch(n){a(h,d(n.message))}}function d(e){const t=n("div","mima-error");return t.textContent=e||"An error occurred.",t}function c(){if(document.getElementById("mima-styles"))return;const n=document.createElement("style");n.id="mima-styles",n.textContent="\n* {\n  line-height: 1.2;\n}\nh1,h2,h3,h4,h5,h6,p {\n  all: unset;\n  line-height: 1.4;\n  display: block;\n}\nh1,h2,h3,h4,h5,h6 { font-weight: 600; }\n\n:root {\n  --primary-normal: #1f68d6;\n  --primary-hover: #003c97;\n  --grey-200: #e5e7eb;\n  --dark-700: #414651;\n  --dark-900: #1f2937;\n}\n\n/* Overlay & Modal */\n.mima-scroll-lock { overflow: hidden; }\n\n.checkoutModal {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100vw;\n  height: 100vh;\n  z-index: 9999;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-family: inherit;\n}\n\n.backdrop {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.4);\n  top: 0;\n  left: 0;\n  z-index: -1;\n}\n\n.modalContent {\n    background-color: #fff;\n  padding: 30px 20px;\n  border-radius: 12px;\n  position: relative;\n  z-index: 10000;\n  animation: modalFadeIn 0.25s ease-out;\n}\n\n@keyframes modalFadeIn {\n  0% { opacity:0; transform:scale(.96); }\n  100% { opacity:1; transform:scale(1); }\n}\n\n/* Header */\n.mima-head { display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid #eee; }\n.mima-title { font-weight:600; font-size:16px; }\n.mima-close { background:transparent; border:none; font-size:24px; cursor:pointer; }\n\n/* Body + Footer */\n.mima-body { padding:16px; }\n.mima-foot { padding:12px 16px 16px; }\n\n/* Buttons */\n.buttonBase,\n.mima-btn {\n  height:40px;\n  padding:8px 12px;\n  border-radius:6px;\n  cursor:pointer;\n  width:fit-content;\n  display:flex;\n  justify-content:center;\n  align-items:center;\n  gap:8px;\n  white-space:nowrap;\n  outline:none;\n  border:none;\n  font-weight:600;\n  transition: background-color .2s ease;\n  box-sizing: border-box;\n}\n.buttonBase:disabled,\n.mima-btn:disabled,\n.mima-btn.disabled {\n  background-color:#ccc;\n  cursor:not-allowed;\n}\n.buttonDefault,\n.mima-btn {\n  background-color:var(--primary-normal);\n  color:#fff;\n}\n.buttonDefault:hover,\n.mima-btn:hover { background-color:var(--primary-hover); }\n.buttonOutlined,\n.mima-btn.outlined {\n  background:transparent;\n  border:1px solid var(--grey-200);\n  color:var(--dark-700);\n}\n.buttonOutlined:hover,\n.mima-btn.outlined:hover {\n  border-color:var(--dark-700);\n  color:var(--dark-900);\n  background-color:var(--grey-200);\n}\n.buttonText,\n.mima-btn.text {\n  background:transparent;\n  color:var(--primary-normal);\n}\n.buttonText:hover,\n.mima-btn.text:hover { color:var(--primary-hover); }\n.buttonFull,\n.mima-btn.full { width:100%; }\n.buttonDisabled { opacity:.6; pointer-events:none; }\n\n/* Error + Loading */\n\n.mima-error {\n  background:#fff;\n  color:#d32f2f;\n  font-weight:500;\n  padding:20px;\n  border-radius:10px;\n  border:1px solid #d32f2f;\n  text-align:center;\n}\n\n.mima-center {\n  display:flex;\n  align-items:center;\n  justify-content:center;\n  background:#fff;\n  padding:20px;\n  border-radius:10px;\n}\n\n/* Spinner */\n.spinner,\n.mima-spinner {\n  border:2px solid rgba(0,0,0,.1);\n  border-top:2px solid var(--primary-normal);\n  border-radius:50%;\n  width:20px;\n  height:20px;\n  animation: spin .6s linear infinite;\n}\n@keyframes spin { to { transform:rotate(360deg); } }\n\n/* Options & Stripe */\n.mima-option { display:flex; flex-direction: column; align-items: flex-start; gap:12px; border:1px solid #eee; padding:12px; border-radius:12px;}\n.mima-option-logo,\n.logo { height:24px; object-fit:contain; display:block; }\n.mima-option-label,\n.label { display:flex; align-items:center; gap:8px; cursor:pointer; }\n.labelText { font-weight:500; }\n\n.mima-stripe-wrap { display:flex; flex-direction:column; gap:12px; width: 500px; max-width: 100%; }\n.mima-stripe-mount { padding:8px; border:1px solid #eee; border-radius:12px; }\n.mima-stripe-actions { display:grid; grid-template-columns:150px 1fr; gap:1rem; width:100%; margin-top:12px; }\n\n/* Top Section */\n.mima-top,\n.checkoutTop { margin-bottom:8px; display:flex; flex-direction:column; font-size:20px; }\n.mima-top-span,\n.checkoutTopSpan { font-weight:600; color:#136e13; }\n.mima-top-first,\n.checkoutTopFirst { color:#6b7280; font-size:14px; margin-top:4px; }\n\n/* Powered by */\n.mima-powered,\n.mima {display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-top: 10px;\n  gap: 10px;\n  text-decoration: none;\n  color: var(--dark-900); }\n.mima-powered-logo,\n.logo { height: 25px;\n  width: auto;\n  object-fit: contain;\n  display: block; }\n",document.head.appendChild(n)}function l(n){if(!n||!n.payload||!n.signature)throw new Error("MimaCheckout: `payload` and `signature` are required.");return n}const p={open:n=>(c(),s(l(n))),renderButton:n=>(c(),function({selector:n,title:e="Pay with Mima",className:t="",...o}){const a="string"==typeof n?document.querySelector(n):n;if(!a)throw new Error("MimaButton: host element not found");a.classList.add("mima-btn"),t&&a.classList.add(...t.split(" ")),a.textContent=e,a.addEventListener("click",()=>s(o))}(l(n))),renderOption:t=>(c(),function({selector:t,title:o="Pay with Mima",className:a="",...i}){const d="string"==typeof t?document.querySelector(t):t;if(!d)throw new Error("PayWithMima: host element not found");d.classList.add("mima-option"),a&&d.classList.add(...a.split(" "));const c=n("label","mima-option-label"),l=n("input");l.type="radio",l.name=i?.groupName||"mima-pay-option";const p=n("span","mima-option-text");p.textContent=o;const m=n("img","mima-option-logo");m.src=r,m.alt="Mima Logo";const u=n("button","mima-btn full");u.type="button",u.textContent="Pay now",u.style.display="none",l.addEventListener("change",()=>{u.style.display=l.checked?"block":"none"}),u.addEventListener("click",()=>s(i)),e(c,l,p),e(d,c,m,u)}(l(t)))};"undefined"!=typeof window&&(window.MimaCheckout=p);export{p as MimaCheckout,p as default};
//# sourceMappingURL=index.esm.js.map
